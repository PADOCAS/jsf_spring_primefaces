<?xml version="1.0" encoding="UTF-8"?>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/XHtml.xhtml to edit this template
-->
<!DOCTYPE html>
<ui:decorate template="../templates/templatePrincipal.xhtml"
             xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://java.sun.com/jsf/html"
             xmlns:f="http://java.sun.com/jsf/core"
             xmlns:p="http://primefaces.org/ui"
             xmlns:ui="http://java.sun.com/jsf/facelets"
             xmlns:c="http://java.sun.com/jsp/jstl/core"
             xmlns:sec="http://www.springframework.org/security/tags"
             xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
    <ui:define name="corpo">
        <p:ajaxStatus id="ajaxStatus" onstart="PF('statusDialog').show();" onsuccess="PF('statusDialog').hide();" />

        <!--Variável para saber se está cadastrando, consultando, etc.. (usando jsp-jstl)-->
        <c:set var="isCadastro" value="true" scope="view" />

        <p:panel id="pnlCadastro" header="Cadastro de Cidade" >
            <h:panelGrid id="pnlGridCadastro" columns="2" >
                <h:outputLabel id="lblCodigo" class="styleOutputLabel" value="* Código" for="txtCodigo" />
                <p:inputText id="txtCodigo" class="estiloIdCadastro" disabled="true" value="#{cidadeBeanView.objetoSelecionado.codigo}" />

                <h:outputLabel id="lblNome" class="styleOutputLabel" value="* Nome" for="txtNome" />
                <p:inputText id="txtNome" 
                             class="styleInputTextGrande ui-text-uppercase" 
                             value="#{cidadeBeanView.objetoSelecionado.nome}" 
                             required="true" 
                             maxlength="50" 
                             requiredMessage="Informe o Nome da Cidade."/>

                <h:outputLabel id="lblEstado" class="styleOutputLabel" value="* Estado" for="selOneMenuEstado" />
                <p:selectOneMenu id="selOneMenuEstado" 
                                 required="true"
                                 value="#{cidadeBeanView.objetoSelecionado.estado}"
                                 style="width: 220px;"
                                 requiredMessage="Informe o Estado."  >
                    <f:selectItems value="#{cidadeBeanView.listSelectItemEstado}" />
                </p:selectOneMenu>
            </h:panelGrid>               
        </p:panel>

        <div class="espacoBranco" />

        <h:panelGrid columns="2">
            <p:commandButton id="btnSalvar" 
                             value="Salvar (F2)" 
                             ajax="false"
                             actionListener="#{cidadeBeanView.save()}" />

            <p:commandButton id="btnNovo" 
                             value="Novo (F8)"          
                             onclick="redirecionarPagina('#{request.contextPath}', '/cadastro/cad_cidade');">
            </p:commandButton>
        </h:panelGrid>

        <div class="espacoBranco" />

        <p:dataTable id="dataTableListCidade"
                     value="#{cidadeBeanView.listAllCidade}"
                     var="cid"
                     rows="5" 
                     paginator="true"
                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords} registros"
                     rowsPerPageTemplate="5,10,15"
                     emptyMessage="Nenhuma Cidade cadastrada.">
            <p:column style="width: 10%;">
                <f:facet name="header" >Código</f:facet>
                <h:outputText value="#{cid.codigo}" />
            </p:column>

            <p:column style="width: 62%;">
                <f:facet name="header" >Nome</f:facet>
                <h:outputText value="#{cid.nome}" />
            </p:column>

            <p:column style="text-align: center; width: 8%;">
                <f:facet name="header" >UF</f:facet>
                <h:outputText value="#{cid.estado.siglauf}" />
            </p:column>

            <sec:authorize access="(hasAuthority('CIDADE_EDITAR') or hasAuthority('ADMIN'))">
                <p:column style="text-align: center; width: 10%;">
                    <f:facet name="header" >Editar</f:facet>
                    <h:commandLink id="cmdLinkEditar"
                                   immediate="true">                       
                        <f:setPropertyActionListener target="#{cidadeBeanView.objetoSelecionado}" value="#{cid}" />
                        <h:graphicImage name="editar.png" library="img" height="20" width="20" title="Editar"></h:graphicImage>
                        <f:ajax execute="cmdLinkEditar" render="@form"/>
                    </h:commandLink>
                </p:column>  
            </sec:authorize>

            <sec:authorize access="(hasAuthority('CIDADE_EXCLUIR') or hasAuthority('ADMIN'))">
                <p:column style="text-align: center; width: 10%;">
                    <f:facet name="header" >Excluir</f:facet>
                    <p:commandLink id="cmdLinkExcluir" 
                                   immediate="true"
                                   process="@this"
                                   update="form:confDialogExclusaoCidade"
                                   oncomplete="PF('confDialogExclusaoCidade').show();">
                        <f:setPropertyActionListener target="#{cidadeBeanView.objetoSelecionado}" value="#{cid}" />
                        <h:graphicImage name="table_remove.png" library="img" height="20" width="20" title="Excluir"></h:graphicImage>
                        <f:ajax execute="cmdLinkExcluir" render="form:pnlCadastro" />
                    </p:commandLink>
                </p:column>
            </sec:authorize>
        </p:dataTable>

        <p:confirmDialog id="confDialogExclusaoCidade"
                         widgetVar="confDialogExclusaoCidade"
                         class="ui-dialog-ative-atalho"
                         header="Exclusão"                         
                         message="Confirma a Exclusão da Cidade: (#{cidadeBeanView.objetoSelecionado.codigo}) #{cidadeBeanView.objetoSelecionado.nome} ?"
                         closable="false">
            <h:panelGrid id="pnlGridExclusaoCidade" columns="2">
                <p:commandButton id="btnExclusaoSim" 
                                 value="Sim (F2)" 
                                 update="form"
                                 onsuccess="PF('confDialogExclusaoCidade').hide();"
                                 actionListener="#{cidadeBeanView.excluir()}" />
                <p:commandButton id="btnExclusaoNao" 
                                 value="Não (ESC)"         
                                 update="form"
                                 actionListener="#{cidadeBeanView.novo()}"
                                 onclick="PF('confDialogExclusaoCidade').hide();">
                </p:commandButton>
            </h:panelGrid> 
        </p:confirmDialog>

        <script type="text/javascript" charset="UTF-8">
            //Evita conflito entre bibliotecas:
            jQuery.noConflict();

            //Foco no campo nome ao carregar a tela:
//            jQuery('input[name="form:txtNome"]').focus();
            addFocoAoCampo("txtNome");
            tabInTeclaEnter();
        </script>
    </ui:define>
</ui:decorate>